<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Log In — Spree</title>
    <link rel="shortcut icon" href="assets/icon.png" type="image/x-icon">
    <style>
        :root {
            --font-base: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        body {
            font-family: var(--font-base);
            font-weight: 400;
            letter-spacing: 0.2px;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            color: #eaf2ff;
            background-color: #051023;
        }

        :root {
            --bg: #051023;
            --card: #071428;
            --accent: #7b61ff;
            --muted: #9fb0c9;
            --text: #eaf2ff
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            height: 100%;
            font-family: Inter, system-ui, Arial;
            background: linear-gradient(180deg, #021026 0%, #051428 100%);
            color: var(--text);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px
        }

        .card {
            width: 100%;
            max-width: 420px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), transparent);
            border-radius: 14px;
            padding: 22px;
            border: 1px solid rgba(255, 255, 255, 0.03);
            box-shadow: 0 10px 30px rgba(2, 6, 23, 0.6)
        }

        h2 {
            margin: 0 0 8px
        }

        p.small {
            color: var(--muted);
            margin: 0 0 18px
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px
        }

        input {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            background: transparent;
            color: var(--text);
            margin-bottom: 12px
        }

        .btn {
            background: var(--accent);
            border: 0;
            padding: 10px 14px;
            border-radius: 10px;
            color: #fff;
            font-weight: 700;
            cursor: pointer;
            width: 100%
        }

        .link {
            display: block;
            text-align: center;
            margin-top: 12px;
            color: var(--muted);
            text-decoration: none
        }

        .help {
            font-size: 13px;
            color: var(--muted);
            margin-top: 10px
        }

        .error {
            color: #ff6b6b;
            font-size: 13px;
            margin-bottom: 8px
        }

        .back-home-btn {
            display: block;
            width: fit-content;
            margin: 18px auto 0;
            /* center it under the paragraph */
            text-align: center;
            background: transparent;
            color: var(--accent);
            font-weight: 600;
            text-decoration: none;
            border: 1px solid var(--accent);
            border-radius: 8px;
            padding: 8px 20px;
            transition: all 0.1s ease;
        }

        .back-home-btn:hover {
            background: var(--accent);
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(123, 97, 255, 0.3);
        }
    </style>
</head>

<body>
    <main class="card" role="main">
        <h2>Welcome back</h2>
        <p class="small">Log in to manage your bookings.</p>

        <div id="err" class="error" style="display:none"></div>

        <form id="loginForm" novalidate>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" required placeholder="you@example.com" />

            <label for="password">Password</label>
            <input id="password" name="password" type="password" required placeholder="Your password" />

            <button type="submit" class="btn">Log In</button>
        </form>

        <a class="link" href="signup.html">Don't have an account? Sign up</a>
        
        <a href="index.html" class="back-home-btn">← Back to Home</a>

    </main>


    <script>
        // sha256 hex helper (same as signup)
        async function sha256Hex(str) {
            const enc = new TextEncoder();
            const data = enc.encode(str);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        const read = k => { try { return JSON.parse(localStorage.getItem(k) || '{}') } catch (e) { return {} } };

        function showError(msg) { const e = document.getElementById('err'); e.style.display = msg ? 'block' : 'none'; e.textContent = msg || ''; }

        document.getElementById('loginForm').addEventListener('submit', async (ev) => {
            ev.preventDefault();
            showError('');
            const email = document.getElementById('email').value.trim().toLowerCase();
            const pw = document.getElementById('password').value;

            if (!email || !pw) { showError('Please fill in both fields.'); return; }

            try {
                const users = read('users') || {};
                const user = users[email];
                if (!user) { showError('No account found with that email.'); return; }

                const hashed = await sha256Hex(pw);
                if (hashed !== user.passwordHash) { showError('Invalid credentials.'); return; }

                // store session
                sessionStorage.setItem('user', JSON.stringify({ name: user.name, email: user.email, role: 'user' }));
                // redirect to home
                window.location.href = 'index.html';
            } catch (err) {
                console.error(err);
                showError('Login failed. Try again.');
            }
        });
    </script>
</body>

</html>